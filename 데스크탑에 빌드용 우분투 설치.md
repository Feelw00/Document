데스크탑 빌드용 우분투 설치에 대한 회고입니다.

### 서론

신규 프로젝트에 Github Action을 이용하여 빌드 및 배포 자동화를 구축한 상황에서 배포 시 빌드 시간이 너무 오래 걸리는 문제가 발생했습니다.

우선 EKS에 빌드 및 배포용 인스턴스를 생성하였으나 CPU 사용량이 너무 높아 EKS를 2xlarge로 업그레이드 해야했습니다.

하지만 EKS를 2xlarge로 업그레이드하면 비용이 많이 들어가기 때문에 사용하지 않던 데스크탑에 파티션을 나누어 우분투를 설치하고 빌드 및 배포 자동화를 구축하기로 결정했습니다.

### 듀얼 부팅 설정

윈도우가 설치된 데스크탑의 파티션 관리에서 적당한 크기로 파티션을 축소하고 우분투 설치 USB를 만들어 부팅합니다.

우분투 설치 시 설치 유형을 '기타'로 선택하고 파티션을 나누어 설치합니다.

우분투 부팅 디스크를 윈도우 부트 매니저가 있는 파티션에 설치하고 부팅 우선 순위를 우분투로 변경합니다.

### 우분투 부팅 중단 이슈

우분투 설치 후 부팅 시 부팅이 중단되는 문제가 발생했습니다.

해당 문제는 nvidia driver 문제로 인한 것으로 보여 recovery mode로 부팅 후 nvidia driver를 삭제하고 재부팅하여 해결했습니다.

이후 `ubuntu-drivers devices` 명령어로 설치 가능한 드라이버를 확인하고 `sudo apt-get install nvidia-driver-xxx` 명령어로 nvidia driver를 호환되는 버전으로 재설치했습니다.

### ssh 설정

원격 접속을 위해 `sudo apt install openssh-server` 명령어로 ssh 서버를 설치합니다.

`sudo apt install net-tools` 명령어로 네트워크 툴을 설치하고 `ifconfig` 명령어로 ip를 확인합니다.

같은 회선을 사용하는 PC에서 내부 ip로 password로 접속합니다.

### 인터넷 회선 이슈

새로 설치한 데스크탑은 유선 공유기와 연결되어 다른 PC에서 내부 ip로 접속이 가능했지만

와이파이 공유기의 경우 유선 공유기와 회선이 달라 이를 사용하는 PC에서는 내부 ip로 접속이 불가능했습니다.

개발팀에서도 와이파이 공유기를 사용하는 경우가 많아 외부에서 접속할 수 있도록 설정해야 했습니다.

### 외부 접속 설정

우선 유선 공유기에 데스크탑으로 접속할 수 있도록 포트 포워딩을 설정한 후 보안을 위해 pem 키를 생성하여 password로 접속하는 것을 막았습니다.

pem 키를 생성하기 위해 `ssh-keygen -t rsa -m pem` 명령어로 pem 키를 생성하고

id_rsa 파일명을 xxx.pem으로 변경한 후 우분투 서버에 ~/.ssh(700)/authorized_keys(600) 파일을 생성합니다.

id_rsa.pub 파일의 내용을 authorized_keys에 복사한 후 외부에서 pem 키로 접속할 수 있도록 설정했습니다.

### 마치며

이미 Linux가 설치된 가상서버 또는 인스턴스만을 사용하다가 처음으로 데스크탑에 Linux를 설치하게 되었습니다.

포트포워딩으로 인해 외부 접속이 가능해 보안 상 문제가 있을 수 있어 pem키로 어느정도 보안을 강화했지만

추후 vpn이나 ngrrok을 사용하여 보안을 강화할 예정입니다.
